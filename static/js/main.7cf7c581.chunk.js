(this["webpackJsonpweb-games"]=this["webpackJsonpweb-games"]||[]).push([[0],{169:function(e,n,t){},390:function(e,n,t){"use strict";t.r(n);var a=t(0),c=t.n(a),r=t(17),i=t.n(r),o=(t(169),t(47)),l=t(83),s=t(60),u=t(418),d=t(85),b=t(426),p=t(427),j=t(431),f=t(428),h=t(429),m=t(66),v=function(){return Object(o.d)()},g=o.e,O=t(7),y=Object(u.a)({table:{borderCollapse:"collapse",borderSpacing:0},cell:{position:"relative",padding:0,height:"".concat(28,"px"),width:"".concat(28,"px"),border:"1px solid #888",verticalAlign:"top",boxSizing:"border-box",backgroundColor:"rgb(241, 236, 211)"},clickable:{display:"inline-block",position:"absolute",top:"-".concat(8,"px"),left:"-".concat(8,"px"),height:"".concat(15,"px"),width:"".concat(15,"px"),border:"1px solid transparent",borderRadius:"50%",boxSizing:"border-box",cursor:"pointer"},clickableWhite:{border:"1px solid #bbb",backgroundColor:"#fff"},clickableBlack:{border:"1px solid #111",backgroundColor:"#000"},whiteFocused:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.4)"},blackFocused:{boxShadow:"0px 0px 4px 0px rgba(0,0,0,0.8)"}}),x=function(e){var n=e.grid,t=e.focused,a=e.onCellClick,c=y();if(!n||0===n.length)return Object(O.jsx)(d.a,{children:"Failed to load game grid"});var r={B:"".concat(c.clickable," ").concat(c.clickableBlack),W:"".concat(c.clickable," ").concat(c.clickableWhite),U:c.clickable},i={B:c.blackFocused,W:c.whiteFocused},o=function(e,n,a){var c=r[e];return n===t[0]&&a===t[1]?"".concat(c," ").concat(i[e]):c},l=Object(O.jsxs)("tbody",{children:[Object(O.jsx)("tr",{children:new Array(n[0].length+1).fill(null).map((function(e,n){return Object(O.jsx)("td",{className:c.cell},"comp-col-".concat(n))}))}),n.map((function(e,n){return Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{className:c.cell}),e.map((function(e,t){return Object(O.jsx)("td",{className:c.cell,children:Object(O.jsx)("span",{className:o(e,n,t),onClick:function(){return a(n,t)}})},"cell-".concat(n,"-").concat(t))}))]},"row-".concat(n))}))]});return Object(O.jsx)("table",{className:c.table,children:l})},k=t(54),E="game",w="".concat(E,"/JOIN_GAME"),A="".concat(E,"/JOIN_GAME_FAILURE"),I="".concat(E,"/REQUEST_GAME_PLAY"),S="".concat(E,"/REQUEST_GAME_RESTART"),C=("".concat(E,"/GAME_PLAY_FAILURE"),"".concat(E,"/GAME_EVENT")),N="user",G="".concat(N,"/getUser"),U="".concat(N,"/updateUsername"),_="".concat(N,"/updateUsernameAndStartGame"),M="".concat(N,"/updateUsernameAndJOINGame"),R="".concat("ws","/CONNECT"),T="".concat("ws","/EMIT"),L=Object(k.a)((function(e){return e.game}),(function(e){return e.games})),P=t(27),F=function(e,n){return Object(P.c)(e,n)},W=F(R,(function(e,n){var t=n.extra.websocketService;return t.connect(),new Promise((function(e){return t.on("connect",(function(){e(null)}))}))})),B=Object(P.b)(T,(function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),a=1;a<n;a++)t[a-1]=arguments[a];return{payload:{event:e,args:t}}})),J=F(w,(function(e,n){var t=n.extra.websocketService;return n.dispatch(W(null)).then((function(){t.emit("GAME_JOIN",{gameId:e})}))})),z=F(I,(function(e,n){return n.dispatch(B("GAME_PLAY",e))})),D=F(S,(function(e,n){return n.dispatch(B("GAME_RESTART",{gameId:e}))})),Y=t(421),V=t(422),Q=t(423),K=t(424),q=t(151),H=t.n(q),X=function(e){var n=e.players.map((function(e){return Object(O.jsxs)(Y.a,{children:[Object(O.jsx)(V.a,{children:Object(O.jsx)(H.a,{})}),Object(O.jsx)(Q.a,{children:e.displayName})]},e.id)}));return Object(O.jsx)(K.a,{dense:!0,subheader:Object(O.jsx)(d.a,{variant:"subtitle1",children:"Players"}),children:n})},Z=function(e){return e.user},$="/gomoku",ee=t(425),ne=Object(a.memo)((function(e){var n=e.winner,t=(null!==n&&void 0!==n?n:{}).displayName;return Object(O.jsx)(ee.a,{in:Boolean(n),children:Object(O.jsx)(j.a,{padding:2,justifyContent:"center",children:Object(O.jsxs)(d.a,{variant:"h5",align:"center",children:[t," ","has won!"]})})})})),te=["B","W"],ae=Object(u.a)((function(e){return{container:{paddingTop:e.spacing(4)},boardContainer:{display:"flex",justifyContent:"center"}}})),ce=Object(a.memo)((function(){var e,n=v(),t=ae(),c=Object(l.g)().id,r=g(function(e){return Object(k.a)(L,(function(n){return n[e]}))}(c)),i=g(Z),o=Boolean(i.displayName);Object(a.useEffect)((function(){o&&n(J(c))}),[n,c,o]);var s=null!==r&&void 0!==r?r:{},u=s.dimensions,y=s.actions,E=void 0===y?[]:y,w=s.players,A=void 0===w?[]:w,I=s.ended,S=s.winner,C=s.owner,N=Object(a.useMemo)((function(){return A.reduce((function(e,n,t){return e[n.id]=te[t],e}),{})}),[A]),G=Object(a.useMemo)((function(){if(!u)return[];var e=new Array(u[0]).fill(null).map((function(){return new Array(u[1]).fill("U")}));return E.forEach((function(n){var t,a=n.playerId,c=n.x,r=n.y;e[c][r]=null!==(t=N[a])&&void 0!==t?t:null})),e}),[u,N,E]),U=Object(a.useMemo)((function(){var e;return null!==(e=A.find((function(e){return e.id===S})))&&void 0!==e?e:null}),[A,S]),_=C&&i&&C.id===i.id,M=Object(a.useCallback)((function(e,t){n(z({gameId:c,action:{x:e,y:t}}))}),[n,c]),R=Object(a.useCallback)((function(){return n(D(c))}),[n,c]);if(!o)return Object(O.jsx)(l.a,{to:"".concat("/","?join=").concat(c)});if(!r)return Object(O.jsx)(d.a,{children:"Loading..."});if(I)return Object(O.jsx)(d.a,{children:"The game has ended"});var T=null!==(e=Object(m.last)(E))&&void 0!==e?e:{},P=T.x,F=void 0===P?null:P,W=T.y,B=void 0===W?null:W;return Object(O.jsx)(b.a,{className:t.container,children:Object(O.jsxs)(p.a,{container:!0,children:[Object(O.jsx)(p.a,{item:!0,md:8,className:t.boardContainer,children:Object(O.jsxs)(j.a,{display:"flex",flexDirection:"column",children:[Object(O.jsx)(ne,{winner:U}),A.length<2?Object(O.jsx)(d.a,{children:"Waiting for another player to join"}):Object(O.jsx)(x,{grid:G,focused:[F,B],onCellClick:M})]})}),Object(O.jsxs)(p.a,{item:!0,md:4,children:[Object(O.jsx)(f.a,{children:Object(O.jsx)(j.a,{padding:2,children:Object(O.jsx)(X,{players:A})})}),S&&_&&Object(O.jsx)(f.a,{children:Object(O.jsx)(j.a,{padding:2,marginTop:2,children:Object(O.jsx)(h.a,{variant:"contained",color:"secondary",onClick:R,children:"Restart"})})})]})]})})})),re=t(430),ie=t(152),oe=t.n(ie),le=t(25),se=F(G,(function(e,n){return n.extra.userService.getUser()})),ue=F(U,(function(e,n){var t=n.getState().user.displayName;return t?n.extra.userService.setUser({displayName:t}):n.rejectWithValue("Invalid name")})),de=F(_,(function(e,n){return n.dispatch(ue(null)).then((function(){return n.extra.gameService.createGame().then((function(e){return n.dispatch(Object(le.d)("".concat($,"/").concat(e.gameId)))}))}))})),be=F(M,(function(e,n){return n.dispatch(ue(null)).then((function(){return n.dispatch(Object(le.d)("".concat($,"/").concat(e)))}))})),pe={id:null,displayName:null},je=Object(P.d)({name:N,initialState:pe,reducers:{setDisplayName:function(e,n){e.displayName=n.payload}},extraReducers:function(e){e.addCase(se.pending,(function(){return pe})),e.addCase(se.fulfilled,(function(e,n){e.id=n.payload.id,e.displayName=n.payload.displayName})),e.addCase(se.rejected,(function(e,n){console.error(n.payload)})),e.addCase(ue.fulfilled,(function(e,n){var t=n.payload;e.id=t.id,e.displayName=t.displayName})),e.addCase(de.rejected,(function(e,n){console.error(n.payload)}))}}),fe=je.actions.setDisplayName,he={background:{color:{value:"#fff"},position:"50% 50%",repeat:"no-repeat",size:"cover"},fullScreen:{enable:!0,zIndex:1},particles:{number:{value:50},shape:{type:"circle"},color:{value:"random"},lineLinked:{enable:!1},opacity:{value:.3},rotate:{value:0,random:!0,direction:"counter-clockwise",animation:{enable:!0,speed:15,sync:!1}},size:{value:10,random:{enable:!0,minimumValue:5}},move:{enable:!0,speed:1,random:!1,outMode:"bounce"}}},me=Object(u.a)((function(e){return{paper:{zIndex:e.zIndex.speedDial},goButton:{marginTop:e.spacing(1)}}})),ve=function(){var e,n=me(),t=v(),c=g(Z),r=Object(l.f)(),i=new URLSearchParams(r.search).get("join"),o=Object(a.useCallback)((function(e){return t(fe(e.target.value))}),[t]),s=Object(a.useCallback)((function(){t(i?be(i):de(null))}),[t]);return Object(a.useEffect)((function(){t(se(null))}),[t]),Object(O.jsxs)(b.a,{children:[Object(O.jsx)(j.a,{position:"fixed",top:0,left:0,children:Object(O.jsx)(oe.a,{options:he})}),Object(O.jsx)(j.a,{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",children:Object(O.jsx)(f.a,{variant:"outlined",className:n.paper,children:Object(O.jsxs)(j.a,{px:6,py:4,children:[Object(O.jsx)(d.a,{paragraph:!0,children:"Please choose a name (.^\u25e1^.)"}),Object(O.jsx)(re.a,{fullWidth:!0,name:"Name",size:"small",placeholder:"Name",value:null!==(e=c.displayName)&&void 0!==e?e:"",variant:"outlined",onChange:o}),Object(O.jsx)(h.a,{fullWidth:!0,variant:"contained",color:"primary",className:n.goButton,onClick:s,children:"Go"})]})})})]})};var ge,Oe=function(e){return Object(O.jsx)(s.a,{history:e.history,children:Object(O.jsxs)(l.d,{children:[Object(O.jsx)(l.b,{path:"".concat($,"/:id"),component:ce}),Object(O.jsx)(l.b,{path:"/",component:ve})]})})},ye=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,433)).then((function(n){var t=n.getCLS,a=n.getFID,c=n.getFCP,r=n.getLCP,i=n.getTTFB;t(e),a(e),c(e),r(e),i(e)}))},xe=t(37),ke=t(145),Ee="https://the-online-games.herokuapp.com/",we=t(43),Ae=t(44),Ie=function(){function e(n){Object(we.a)(this,e),this.httpService=void 0,this.httpService=n}return Object(Ae.a)(e,[{key:"createGame",value:function(){return this.httpService.post("/api/v1/game",null,{withCredentials:!0})}}]),e}(),Se=t(84),Ce=t.n(Se),Ne=function(){function e(n){Object(we.a)(this,e),this.baseUrl=void 0,this.baseUrl=n}return Object(Ae.a)(e,[{key:"getUrl",value:function(e){return new URL(e,this.baseUrl).href}},{key:"get",value:function(e,n){return Ce.a.get(this.getUrl(e),n).then((function(e){return e.data}))}},{key:"put",value:function(e,n,t){return Ce.a.put(this.getUrl(e),n,t).then((function(e){return e.data}))}},{key:"post",value:function(e,n,t){return Ce.a.post(this.getUrl(e),n,t).then((function(e){return e.data}))}}]),e}(),Ge="/api/v1/user",Ue=function(){function e(n){Object(we.a)(this,e),this.httpService=void 0,this.httpService=n}return Object(Ae.a)(e,[{key:"getUser",value:function(){return this.httpService.get(Ge,{withCredentials:!0})}},{key:"setUser",value:function(e){return this.httpService.put(Ge,e,{withCredentials:!0})}}]),e}(),_e=t(57),Me=t(30),Re=je.reducer,Te=Object(P.d)({name:E,initialState:{games:{}},reducers:{joinGameSuccess:function(e,n){var t=e.games,a=n.payload;t[a.gameId]=a},gamePlayEvent:function(e,n){var t=e.games,a=n.payload,c=a.gameId,r=a.action;if(t[c])switch(t[c].name){case"gomoku":t[c].actions.push(r)}},playerJoinEvent:function(e,n){var t=e.games,a=n.payload,c=a.gameId,r=a.player;if(t[c]){var i=t[c].players;Object(m.remove)(i,(function(e){return e.id===r.id})),i.push(r)}},playerLeaveEvent:function(e,n){var t=e.games,a=n.payload,c=a.gameId,r=a.playerId;if(t[c]){var i=t[c].players;Object(m.remove)(i,(function(e){return e.id===r}))}},gameEndEvent:function(e,n){var t=e.games,a=n.payload.gameId;t[a]&&(t[a].ended=!0)},gameRestartEvent:function(e,n){var t=e.games,a=n.payload,c=a.gameId,r=a.snapshot;t[c]&&(t[c]=r)},gomokuGameWinEvent:function(e,n){var t=e.games,a=n.payload,c=a.gameId,r=a.winner;t[c]&&(t[c].winner=r)}}}),Le=Te.reducer,Pe=t(154),Fe=function(){function e(n){Object(we.a)(this,e),this.socket=void 0,this.socket=Object(Pe.io)(n,{withCredentials:!0,autoConnect:!1})}return Object(Ae.a)(e,[{key:"connect",value:function(){this.socket.disconnected&&this.socket.connect()}},{key:"disconnect",value:function(){this.socket.connected&&this.socket.disconnect()}},{key:"emit",value:function(e){for(var n,t=arguments.length,a=new Array(t>1?t-1:0),c=1;c<t;c++)a[c-1]=arguments[c];(n=this.socket).emit.apply(n,[e].concat(a))}},{key:"on",value:function(e,n){this.socket.on(e,n)}},{key:"onAny",value:function(e){this.socket.onAny(e)}}]),e}(),We=t(155),Be=Te.actions,Je=Be.joinGameSuccess,ze=Be.gamePlayEvent,De=Be.playerJoinEvent,Ye=Be.playerLeaveEvent,Ve=Be.gameEndEvent,Qe=Be.gameRestartEvent,Ke=Be.gomokuGameWinEvent,qe=Object(P.b)(A),He=Object(P.b)(C,(function(e){return{payload:e}})),Xe=(ge={},Object(_e.a)(ge,"GAME_EVENT",(function(e){var n=e.type,t=e.gameId,a=e.payload;switch(n){case"PLAYER_JOIN":return De({gameId:t,player:a});case"PLAYER_LEAVE":return Ye({gameId:t,playerId:a});case"GAME_PLAY":return ze({gameId:t,action:a});case"GAME_END":return Ve({gameId:t});case"GAME_RESTART":return Qe({gameId:t,snapshot:a});case"GOMOKU_GAME_WIN":return Ke({gameId:t,winner:a})}return He(e)})),Object(_e.a)(ge,"GAME_JOIN_SUCCESS",Je),Object(_e.a)(ge,"GAME_JOIN_FAILURE",qe),ge),Ze=function(e){return function(n){return function(t){return function(a){switch(a.type){case W.fulfilled.type:!function(e,n){e.api.websocketService.onAny((function(e,t){var a=Xe[e];a&&n.dispatch(a(t))}))}(e,n);break;case T:!function(e,n){var t,a=e.api,c=n.payload,r=c.event,i=c.args;(t=a.websocketService).emit.apply(t,[r].concat(Object(We.a)(i)))}(e,a)}return t(a)}}}},$e=new Ne(Ee),en=new Fe(Ee),nn={userService:new Ue($e),gameService:new Ie($e),websocketService:en},tn=Object(xe.a)({basename:"/web-games"}),an=Object(P.a)({reducer:function(e){var n;return Object(Me.b)((n={router:Object(s.b)(e)},Object(_e.a)(n,N,Re),Object(_e.a)(n,E,Le),n))}(tn),middleware:function(e){return e({thunk:{extraArgument:nn}}).concat(Object(ke.a)(tn)).concat(Ze({api:nn}))},devTools:!1});i.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(o.a,{store:an,children:Object(O.jsx)(Oe,{history:tn})})}),document.getElementById("root")),ye()}},[[390,1,2]]]);
//# sourceMappingURL=main.7cf7c581.chunk.js.map